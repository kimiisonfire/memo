191105_oracle

오늘은 함수한다!  = 사용자 정의 함수
프로시져랑 비슷하지 함수는

다른점이 있다면 함수는 
- 매개변수선언부에서 반환할 변수에 대해서 
  	>>RETURN 데이터타입<< 이 꼭 있어야돼
	자바 메서드의 반환타입 붙이는거랑 같다고 생각하면댐
	그리고 여기서도 역시 크기 설정 아니고 타입만 설정해라
- 그리고 BEGIN블록에서 반드시 하나이상의 RETURN문이 있어서
반드시1!!!값이 RETURN 되어야함


함수를 호출하는 부분과 실제 함수부분을 나눠서 작성할줄알아야함


함수랑 프로시져 차이는 또있는데말이져
프로시져는 복수의 결과를 낼수없음 프로시져 실행결과는 딱 한줄이야
이걸 LOOP 써서 여러줄뽑아내고 그런거였음
근데 함수같은경우에는 SELECT문에 함수를 써주면
한 레코드마다 한번씩 함수가 호출되는거임
그래서 하나의 함수를 여러번 호출해서 복수의 결과를 낼수가있다

SELECT문에서 함수를 호출하면
SELECT '2005' AS 년도,
       CART_PROD, 
       FN_CART01('2005',CART_PROD)
  FROM CART;
----> 이런식으로말여
그러면 SELECT 결과에서 한 레코드마다 한번씩 함수가 호출되는거임...!!!!!
존나신기하네



~~~~~~ 트리거~~~~~~~
buyprod 테이블에서 오늘날짜로 100개 샀다고해봐
그럼 그만큼 insert 돼야하잖아
근데 buyprod테이블의 insert만으로 끝나면 안되고 
remain 테이블=재고테이블도 수정돼야하잖아!
=== buyprod insert 이후에 진행되는 remain update

그래서 buyprod insert 동작이 실행될경우
remain테이블에 update를 자동으로 진행하세요! === 이게 트리거다 이거임

emp테이블의 사원이 승진하거나 부서이동하면  = update
job_history 테이블에서 변동사항을 insert 해야하잖여
emp update --> job_history insert 를 자동으로 되게 하는거임 = 트리거


트리거에는 new, old라는 의사컬럼이 사용됨
전에있던 자료, 새로운 자료를 보관하는거임

이것도 결국에는 쿼리를 어떻게 짜고 어떻게 실행할건가하는문제임


TIMING이라는건 걍 선생님이 표시해놓은거지 쓰지마세요 예약어아님

ON 다음에 나오는 테이블명에서 INSERT, UPDATE, DELETE가 발생하면
BEGIN 다음에 나오는 명령들을 하면 됩니다

보통 FOR EACH ROW를 씀
5개 DELETE 했다 -> TRIGGER 다섯번 수행함
여기서 :NEW, :OLD를 쓸수있음 신규값과 이전값을 별도로 보관하는 의사컬럼이거든
근데 FOR EACH ROW 쓸때 주의해야할게있음
트리거 안에 또 트리거가 걸릴수도있거든??
그르면 트리거 안에서 다른 트리거를 호출하면 원본테이블을 보존하기위해서
테이블은 lock걸리고 모든 트리거가 전부 STOP되고 ㅣ에러메세지뜬다
그니까 트리거는 하나가 전부 끝난 다음에 다음 트리거가 되도록 해야댐 미친놈아

잘쓰면 좋은데 잘못쓰면 개판난대 잘써라하여튼 





















